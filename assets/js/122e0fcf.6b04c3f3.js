"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1320],{5141:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"implementation/david-cohen/behaviors","title":"Behavior","description":"Il modulo behavior implementa il sistema decisionale per le entit\xe0 dinamiche, fornendo un framework puro e componibile","source":"@site/docs/05-implementation/03-david-cohen/behaviors.md","sourceDirName":"05-implementation/03-david-cohen","slug":"/implementation/david-cohen/behaviors","permalink":"/PPS-22-srs/docs/implementation/david-cohen/behaviors","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Illumination","permalink":"/PPS-22-srs/docs/implementation/david-cohen/illumination"},"next":{"title":"SimulationView","permalink":"/PPS-22-srs/docs/implementation/david-cohen/simulation-gui"}}');var a=i(4848),l=i(8453);const r={sidebar_position:3},o="Behavior",c={},d=[{value:"Tipi fondamentali",id:"tipi-fondamentali",level:2},{value:"BehaviorContext",id:"behaviorcontext",level:3},{value:"Kleisli Arrow",id:"kleisli-arrow",level:3},{value:"DSL di composizione",id:"dsl-di-composizione",level:2},{value:"Operatori principali",id:"operatori-principali",level:3},{value:"Utility comuni (estratto)",id:"utility-comuni-estratto",level:2},{value:"Implementazioni delle Policy",id:"implementazioni-delle-policy",level:2},{value:"AlwaysForward",id:"alwaysforward",level:3},{value:"RandomWalk",id:"randomwalk",level:3},{value:"ObstacleAvoidance",id:"obstacleavoidance",level:3},{value:"Phototaxis",id:"phototaxis",level:3},{value:"Prioritized",id:"prioritized",level:3},{value:"Come estendere il sistema di behavior",id:"come-estendere-il-sistema-di-behavior",level:2}];function t(e){const n={a:"a",admonition:"admonition",annotation:"annotation",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"behavior",children:"Behavior"})}),"\n",(0,a.jsxs)(n.p,{children:["Il modulo ",(0,a.jsx)(n.code,{children:"behavior"})," implementa il sistema decisionale per le entit\xe0 dinamiche, fornendo un framework puro e componibile\nper la selezione delle azioni basata su input sensoriali."]}),"\n",(0,a.jsx)(n.h2,{id:"tipi-fondamentali",children:"Tipi fondamentali"}),"\n",(0,a.jsx)(n.h3,{id:"behaviorcontext",children:"BehaviorContext"}),"\n",(0,a.jsx)(n.p,{children:"Incapsula l'input immutabile per la decisione:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"final case class BehaviorContext\n(\n  sensorReadings: SensorReadings,\n  rng: RNG\n)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"kleisli-arrow",children:"Kleisli Arrow"}),"\n",(0,a.jsxs)(n.p,{children:["Il modulo utilizza ",(0,a.jsx)(n.code,{children:"Kleisli"})," per modellare funzioni pure con effetti:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"// in BehaviorTypes.scala\ntype Behavior[I, A] = Kleisli[Id, I, A] // I => A (totale)\ntype PartialBehavior[I, A] = Kleisli[Option, I, A] // I => Option[A] (parziale),\ntype Condition[I] = I => Boolean // Predicato\n\n// in BehaviorCommon.scala\ntype Decision[F[_]] = Behavior[BehaviorContext, (Action[F], RNG)]\n"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["Nota: le motivazioni sono descitte in ",(0,a.jsx)(n.a,{href:"/PPS-22-srs/docs/detailed-design/behavior#pattern-kleisli",children:(0,a.jsx)(n.strong,{children:"Design \u2192 Behavior"})}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Una decisione \xe8 una funzione totale che, dato un ",(0,a.jsx)(n.code,{children:"BehaviorContext"}),", restituisce una tupla con l\u2019",(0,a.jsx)(n.code,{children:"Action[F]"})," da eseguire\ne il nuovo stato del generatore di numeri casuali ",(0,a.jsx)(n.code,{children:"RNG"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"// Esempio di Composizione con Kleisli\nval decision: Kleisli[Id, BehaviorContext, (Action[F], RNG)] =\n  Kleisli.ask[Id, BehaviorContext].map { ctx =>\n    // abbiamo a disposizione ctx.readings e ctx.rng\n    // calcoliamo l'azione da restituire\n    (moveForward[F], ctx.rng)\n  }\n"})}),"\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsxs)(n.p,{children:["Per ulteriori informazioni su ",(0,a.jsx)(n.code,{children:"Action[F]"})," e ",(0,a.jsx)(n.code,{children:"RNG"}),", vedere:"]}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/PPS-22-srs/docs/detailed-design/action",children:"Azioni"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/PPS-22-srs/docs/detailed-design/random-number-generator",children:"RNG"})}),"\n"]})]}),"\n",(0,a.jsx)(n.h2,{id:"dsl-di-composizione",children:"DSL di composizione"}),"\n",(0,a.jsxs)(n.p,{children:["Il ",(0,a.jsx)(n.strong,{children:"DSL"})," fornisce combinatori per costruire regole parziali e comporle in behavior totali:"]}),"\n",(0,a.jsx)(n.h3,{id:"operatori-principali",children:"Operatori principali"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"// Crea regola parziale da condizione\ninfix def ==>(cond: Condition[I], act: => A): PartialBehavior[I, A]\n\n// Composizione left-biased\ninfix def |(r1: PartialBehavior[I, A], r2: PartialBehavior[I, A]): PartialBehavior[I, A]\n\n// Chiusura in behavior totale\ndef default(fallback: => A): Behavior[I, A]\n\n// Combinatori logici\ndef and(c1: Condition[I], c2: Condition[I]): Condition[I]\ndef or(c1: Condition[I], c2: Condition[I]): Condition[I]\ndef not(c: Condition[I]): Condition[I]\n"})}),"\n",(0,a.jsx)(n.admonition,{title:"Esempio di creazione di un comportamento semplice",type:"tip",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"/** Definiamo un comportamento che:\n * - se un ostacolo \xe8 vicino (proximity < 0.3), gira a destra;\n * - se la luce \xe8 forte (light > 0.5), si muove verso;\n * - se l'energia \xe8 bassa (energy < 0.2), si ferma;\n * - altrimenti, avanza.\n */\nval behavior = {\n  ((proximity < 0.3) ==> turnRight) |\n    ((light > 0.5) ==> moveToLight) |\n    ((energy < 0.2) ==> stop)\n      .default(moveForward)\n}\n"})})}),"\n",(0,a.jsx)(n.h2,{id:"utility-comuni-estratto",children:"Utility comuni (estratto)"}),"\n",(0,a.jsxs)(n.p,{children:["Il modulo fornisce funzioni helper in ",(0,a.jsx)(n.code,{children:"BehaviorCommon"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"// Clamping e normalizzazione\ndef clamp01(v: Double): Double\ndef clamp(v: Double, lo: Double, hi: Double): Double\ndef toSignedDegrees(deg: Double): Double // [-180, 180]\ndef normalize360(deg: Double): Double\n\n// Azioni predefinite\ndef forward[F[_]]: Action[F]\ndef wheels[F[_] : Monad](l: Double, r: Double): Action[F]\ndef moveOrNo[F[_] : Monad](l: Double, r: Double): Action[F]\n"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["Nota: a tutte le velocit\xe0 viene fatto il clamp tra ",(0,a.jsx)(n.code,{children:"MinSpeed"})," e ",(0,a.jsx)(n.code,{children:"MaxSpeed"}),". I parametri/tuning vivono in\n",(0,a.jsx)(n.code,{children:"io.github.srs.utils.SimulationDefaults"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"implementazioni-delle-policy",children:"Implementazioni delle Policy"}),"\n",(0,a.jsx)(n.h3,{id:"alwaysforward",children:"AlwaysForward"}),"\n",(0,a.jsxs)(n.p,{children:["Comportamento minimale deterministico: ritorna sempre ",(0,a.jsx)(n.code,{children:"forward[F]"})," e l\u2019",(0,a.jsx)(n.code,{children:"rng"})," intatto. Utile come baseline/fallback."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"def decision[F[_]]: Decision[F] =\n  Kleisli(ctx => (forward[F], ctx.rng))\n"})}),"\n",(0,a.jsx)(n.p,{children:"Procedura:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"ignora le letture sensoriali;"}),"\n",(0,a.jsx)(n.li,{children:"seleziona sempre l\u2019azione \u201cavanti\u201d a velocit\xe0 di crociera;"}),"\n",(0,a.jsxs)(n.li,{children:["clamp delle velocit\xe0 in ",(0,a.jsx)(n.code,{children:"[MinSpeed, MaxSpeed]"}),";"]}),"\n",(0,a.jsxs)(n.li,{children:["RNG restituito ",(0,a.jsx)(n.strong,{children:"invariato"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"randomwalk",children:"RandomWalk"}),"\n",(0,a.jsx)(n.p,{children:"Esplorazione stocastica con bias in avanti e sterzata variabile."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"def decision[F[_] : Monad]: Decision[F] = Kleisli { ctx =>\n  val (uF, r1) = ctx.rng.generate(range)\n  val (uT, r2) = r1.generate(range)\n  val (uM, r3) = r2.generate(range)\n\n  val base = calculateBaseSpeed(uF)\n  .\n..\n  val turn = calculateTurn(uT, uM)\n  val (left, right) = applyTurnToWheels(base, turn)\n\n  (moveOrNo[F](left, right), r3)\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"Procedura:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["estrae tre valori uniformi e indipendenti in ",(0,a.jsx)(n.code,{children:"[MinSpeed, MaxSpeed]"}),":\n",(0,a.jsx)(n.code,{children:"uF"})," (base-speed), ",(0,a.jsx)(n.code,{children:"uT"})," (turn-magnitude), ",(0,a.jsx)(n.code,{children:"uM"})," (pivot-mix); RNG avanza ",(0,a.jsx)(n.code,{children:"r \u2192 r1 \u2192 r2 \u2192 r3"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["calcola la base: ",(0,a.jsxs)(n.span,{className:"katex",children:[(0,a.jsx)(n.span,{className:"katex-mathml",children:(0,a.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(n.semantics,{children:[(0,a.jsxs)(n.mrow,{children:[(0,a.jsx)(n.mi,{children:"M"}),(0,a.jsx)(n.mi,{children:"i"}),(0,a.jsx)(n.mi,{children:"n"}),(0,a.jsx)(n.mi,{children:"F"}),(0,a.jsx)(n.mi,{children:"o"}),(0,a.jsx)(n.mi,{children:"r"}),(0,a.jsx)(n.mi,{children:"w"}),(0,a.jsx)(n.mi,{children:"a"}),(0,a.jsx)(n.mi,{children:"r"}),(0,a.jsx)(n.mi,{children:"d"}),(0,a.jsx)(n.mi,{children:"F"}),(0,a.jsx)(n.mi,{children:"a"}),(0,a.jsx)(n.mi,{children:"c"}),(0,a.jsx)(n.mi,{children:"t"}),(0,a.jsx)(n.mi,{children:"o"}),(0,a.jsx)(n.mi,{children:"r"}),(0,a.jsx)(n.mo,{children:"+"}),(0,a.jsx)(n.mi,{children:"M"}),(0,a.jsx)(n.mi,{children:"a"}),(0,a.jsx)(n.mi,{children:"x"}),(0,a.jsx)(n.mi,{children:"F"}),(0,a.jsx)(n.mi,{children:"o"}),(0,a.jsx)(n.mi,{children:"r"}),(0,a.jsx)(n.mi,{children:"w"}),(0,a.jsx)(n.mi,{children:"a"}),(0,a.jsx)(n.mi,{children:"r"}),(0,a.jsx)(n.mi,{children:"d"}),(0,a.jsx)(n.mi,{children:"E"}),(0,a.jsx)(n.mi,{children:"x"}),(0,a.jsx)(n.mi,{children:"t"}),(0,a.jsx)(n.mi,{children:"r"}),(0,a.jsx)(n.mi,{children:"a"}),(0,a.jsx)(n.mo,{children:"\u2217"}),(0,a.jsx)(n.mi,{mathvariant:"normal",children:"\u2223"}),(0,a.jsx)(n.mi,{children:"u"}),(0,a.jsx)(n.mi,{children:"F"}),(0,a.jsx)(n.mi,{mathvariant:"normal",children:"\u2223"})]}),(0,a.jsx)(n.annotation,{encoding:"application/x-tex",children:"MinForwardFactor + MaxForwardExtra * |uF|"})]})})}),(0,a.jsxs)(n.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.7778em",verticalAlign:"-0.0833em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"M"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"in"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"F"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"or"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"d"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"F"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"c"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"or"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(n.span,{className:"mbin",children:"+"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.6944em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"M"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"x"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"F"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"or"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"d"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"E"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"x"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(n.span,{className:"mbin",children:"\u2217"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(n.span,{className:"mord",children:"\u2223"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"u"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"F"}),(0,a.jsx)(n.span,{className:"mord",children:"\u2223"})]})]})]}),", poi clamp in ",(0,a.jsx)(n.code,{children:"[MinSpeed, MaxSpeed]"}),";"]}),"\n",(0,a.jsxs)(n.li,{children:["deriva l\u2019ampiezza di sterzo da ",(0,a.jsx)(n.code,{children:"|uT|"})," con curva ",(0,a.jsx)(n.code,{children:"TurnExponent"}),", scalata tra ",(0,a.jsx)(n.code,{children:"MinTurnOfBase"})," e ",(0,a.jsx)(n.code,{children:"MaxTurnOfBase"})," (in\nfunzione della base);"]}),"\n",(0,a.jsxs)(n.li,{children:["applica un ",(0,a.jsx)(n.strong,{children:"pivot-boost"})," con bassa probabilit\xe0 (",(0,a.jsx)(n.code,{children:"PivotBoostProb"}),");"]}),"\n",(0,a.jsxs)(n.li,{children:["converte in velocit\xe0 differenziali (sx/dx), clamp in ",(0,a.jsx)(n.code,{children:"[MinSpeed, MaxSpeed]"}),";"]}),"\n",(0,a.jsxs)(n.li,{children:["restituisce azione + ",(0,a.jsx)(n.strong,{children:"RNG successivo"})," a ",(0,a.jsx)(n.code,{children:"r3"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"obstacleavoidance",children:"ObstacleAvoidance"}),"\n",(0,a.jsx)(n.p,{children:"Sistema a tre fasi basato su distanze:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"private enum Phase:\n  case Free, Warn, Blocked\n\ndef decision[F[_] : Monad]: Decision[F] =\n  Kleisli.ask[Id, BehaviorContext].map { ctx =>\n    val readings = ctx.sensorReadings.proximityReadings\n\n    val front = minIn(readings)(deg => math.abs(deg) <= 10)\n    val frontLeft = minIn(readings)(deg => deg > 0.0 && deg <= 100.0)\n    val frontRight = minIn(readings)(deg => deg < 0.0 && deg >= -100.0)\n\n    val phase = pickPhase(frontLeft, frontRight)\n    val sign = turnSign(readings)\n\n    val (l, r) =\n      if front < CriticalDist then (-1.0, -0.1)\n      else\n        phase match\n          case Phase.Free => (CruiseSpeed, CruiseSpeed)\n          case Phase.Warn =>\n            if sign > 0.0 then (WarnSpeed - WarnTurnSpeed, WarnSpeed + WarnTurnSpeed)\n            else (WarnSpeed + WarnTurnSpeed, WarnSpeed - WarnTurnSpeed)\n          case Phase.Blocked =>\n            if sign > 0.0 then (-BackBoost, BackBoost)\n            else (BackBoost, -BackBoost)\n\n    (wheels[F](l, r), ctx.rng)\n  }\n"})}),"\n",(0,a.jsx)(n.p,{children:"Procedura:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["aggrega letture dei sensori di prossimit\xe0 in zone frontali (front, front-left, front-right); valori normalizzati in ",(0,a.jsx)(n.code,{children:"[0,1]"}),";"]}),"\n",(0,a.jsxs)(n.li,{children:["determina la ",(0,a.jsx)(n.strong,{children:"fase"})," tramite soglie: ",(0,a.jsx)(n.code,{children:"SafeDist"}),", ",(0,a.jsx)(n.code,{children:"CriticalDist"})," \u2192 ",(0,a.jsx)(n.code,{children:"Free | Warn | Blocked"}),";"]}),"\n",(0,a.jsx)(n.li,{children:"stima direzione di sterzo via medie emisferiche (sinistra vs destra) e segno conseguente;"}),"\n",(0,a.jsxs)(n.li,{children:["imposta velocit\xe0:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"Free"})," \u2192 ",(0,a.jsx)(n.code,{children:"CruiseSpeed, CruiseSpeed"}),";"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"Warn"})," \u2192 ",(0,a.jsx)(n.code,{children:"WarnSpeed \xb1 WarnTurnSpeed"})," (sterza ",(0,a.jsx)(n.strong,{children:"lontano"})," dal lato pi\xf9 occupato);"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"Blocked"})," \u2192 pivot/retromarcia ",(0,a.jsx)(n.code,{children:"\xb1BackBoost"}),"."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["clamp finale in ",(0,a.jsx)(n.code,{children:"[MinSpeed, MaxSpeed]"}),";"]}),"\n",(0,a.jsxs)(n.li,{children:["RNG restituito ",(0,a.jsx)(n.strong,{children:"invariato"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"phototaxis",children:"Phototaxis"}),"\n",(0,a.jsx)(n.p,{children:"Orientamento verso sorgenti luminose:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"def decision[F[_] : Monad]: Decision[F] =\n  Kleisli.ask[Id, BehaviorContext].map { ctx =>\n    val action =\n      bestLight(ctx.sensorReadings.lightReadings) match\n        case None => moveForward[F]\n        case Some((s, off)) =>\n          val (l, r) = wheelsTowards(s, off)\n          moveOrNo[F](l, r)\n\n    (action, ctx.rng)\n  }\n"})}),"\n",(0,a.jsx)(n.p,{children:"Procedura:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["seleziona la luce \u201cmigliore\u201d per intensit\xe0; tie-break su offset pi\xf9 frontale con tolleranza ",(0,a.jsx)(n.code,{children:"Epsilon"}),";"]}),"\n",(0,a.jsxs)(n.li,{children:["se non \xe8 presente nessuna luce ricade in fallback ",(0,a.jsx)(n.strong,{children:"forward"}),"; altrimenti continua;"]}),"\n",(0,a.jsxs)(n.li,{children:["la velocit\xe0 di base \xe8 proporzionale all\u2019intensit\xe0: ",(0,a.jsxs)(n.span,{className:"katex",children:[(0,a.jsx)(n.span,{className:"katex-mathml",children:(0,a.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(n.semantics,{children:[(0,a.jsxs)(n.mrow,{children:[(0,a.jsx)(n.mi,{children:"M"}),(0,a.jsx)(n.mi,{children:"i"}),(0,a.jsx)(n.mi,{children:"n"}),(0,a.jsx)(n.mi,{children:"F"}),(0,a.jsx)(n.mi,{children:"o"}),(0,a.jsx)(n.mi,{children:"r"}),(0,a.jsx)(n.mi,{children:"w"}),(0,a.jsx)(n.mi,{children:"a"}),(0,a.jsx)(n.mi,{children:"r"}),(0,a.jsx)(n.mi,{children:"d"}),(0,a.jsx)(n.mi,{children:"B"}),(0,a.jsx)(n.mi,{children:"i"}),(0,a.jsx)(n.mi,{children:"a"}),(0,a.jsx)(n.mi,{children:"s"}),(0,a.jsx)(n.mo,{children:"+"}),(0,a.jsx)(n.mo,{stretchy:"false",children:"("}),(0,a.jsx)(n.mn,{children:"1"}),(0,a.jsx)(n.mo,{children:"\u2212"}),(0,a.jsx)(n.mi,{children:"M"}),(0,a.jsx)(n.mi,{children:"i"}),(0,a.jsx)(n.mi,{children:"n"}),(0,a.jsx)(n.mi,{children:"F"}),(0,a.jsx)(n.mi,{children:"o"}),(0,a.jsx)(n.mi,{children:"r"}),(0,a.jsx)(n.mi,{children:"w"}),(0,a.jsx)(n.mi,{children:"a"}),(0,a.jsx)(n.mi,{children:"r"}),(0,a.jsx)(n.mi,{children:"d"}),(0,a.jsx)(n.mi,{children:"B"}),(0,a.jsx)(n.mi,{children:"i"}),(0,a.jsx)(n.mi,{children:"a"}),(0,a.jsx)(n.mi,{children:"s"}),(0,a.jsx)(n.mo,{stretchy:"false",children:")"}),(0,a.jsx)(n.mo,{children:"\u2217"}),(0,a.jsx)(n.mi,{children:"s"}),(0,a.jsx)(n.mi,{children:"t"}),(0,a.jsx)(n.mi,{children:"r"}),(0,a.jsx)(n.mi,{children:"e"}),(0,a.jsx)(n.mi,{children:"n"}),(0,a.jsx)(n.mi,{children:"g"}),(0,a.jsx)(n.mi,{children:"t"}),(0,a.jsx)(n.mi,{children:"h"})]}),(0,a.jsx)(n.annotation,{encoding:"application/x-tex",children:"MinForwardBias + (1 \u2212 MinForwardBias) * strength"})]})})}),(0,a.jsxs)(n.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.7778em",verticalAlign:"-0.0833em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"M"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"in"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"F"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"or"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"d"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.05017em"},children:"B"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"ia"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"s"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(n.span,{className:"mbin",children:"+"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(n.span,{className:"mopen",children:"("}),(0,a.jsx)(n.span,{className:"mord",children:"1"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(n.span,{className:"mbin",children:"\u2212"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"M"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"in"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"F"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"or"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"d"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.05017em"},children:"B"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"ia"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"s"}),(0,a.jsx)(n.span,{className:"mclose",children:")"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(n.span,{className:"mbin",children:"\u2217"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"s"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"re"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"n"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"h"})]})]})]}),", clamp in ",(0,a.jsx)(n.code,{children:"[MinSpeed, MaxSpeed]"}),";"]}),"\n",(0,a.jsxs)(n.li,{children:["lo sterzo dipende dall'errore angolare normalizzato (",(0,a.jsxs)(n.span,{className:"katex",children:[(0,a.jsx)(n.span,{className:"katex-mathml",children:(0,a.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(n.semantics,{children:[(0,a.jsxs)(n.mrow,{children:[(0,a.jsx)(n.mi,{mathvariant:"normal",children:"\u2223"}),(0,a.jsx)(n.mi,{children:"o"}),(0,a.jsx)(n.mi,{children:"f"}),(0,a.jsx)(n.mi,{children:"f"}),(0,a.jsx)(n.mi,{children:"s"}),(0,a.jsx)(n.mi,{children:"e"}),(0,a.jsx)(n.mi,{children:"t"}),(0,a.jsx)(n.mi,{mathvariant:"normal",children:"\u2223"}),(0,a.jsx)(n.mi,{mathvariant:"normal",children:"/"}),(0,a.jsx)(n.mn,{children:"180"})]}),(0,a.jsx)(n.annotation,{encoding:"application/x-tex",children:"|offset|/180"})]})})}),(0,a.jsx)(n.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(n.span,{className:"mord",children:"\u2223"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"o"}),(0,a.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.10764em"},children:"ff"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"se"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,a.jsx)(n.span,{className:"mord",children:"\u2223/180"})]})})]}),"), guadagno ",(0,a.jsx)(n.code,{children:"TurnGain"}),"; segno verso la luce;"]}),"\n",(0,a.jsxs)(n.li,{children:["converte in velocit\xe0 differenziali e clamp in ",(0,a.jsx)(n.code,{children:"[MinSpeed, MaxSpeed]"}),";"]}),"\n",(0,a.jsxs)(n.li,{children:["RNG restituito ",(0,a.jsx)(n.strong,{children:"invariato"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"prioritized",children:"Prioritized"}),"\n",(0,a.jsxs)(n.p,{children:["Composizione gerarchica di comportamenti in modo dichiarativo. Non duplica logiche ma le ",(0,a.jsx)(n.strong,{children:"orchestra"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"// behaviors/PrioritizedBehavior.scala (cuore)\ndef decision[F[_] : Monad]: Decision[F] =\n  val danger: Condition[BehaviorContext] =\n    ctx => ctx.sensorReadings.proximityReadings.exists(_.value < Behaviors.Prioritized.DangerDist)\n\n  val hasLight: Condition[BehaviorContext] =\n    ctx => ctx.sensorReadings.lightReadings.exists(_.value >= Behaviors.Prioritized.LightThreshold)\n\n  val chooser: Behavior[BehaviorContext, BehaviorContext => (Action[F], RNG)] =\n    (\n      (danger ==> ObstacleAvoidanceBehavior.decision[F].run) |\n        (hasLight ==> PhototaxisBehavior.decision[F].run)\n      ).default(RandomWalkBehavior.decision[F].run)\n\n  Kleisli.ask[Id, BehaviorContext].flatMap { ctx =>\n    Kleisli.liftF(chooser.run(ctx)(ctx))\n  }\n"})}),"\n",(0,a.jsx)(n.p,{children:"Procedura:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["valuta condizioni globali:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"danger"})," se prossimit\xe0 < ",(0,a.jsx)(n.code,{children:"DangerDist"}),";"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"hasLight"})," se luce \u2265 ",(0,a.jsx)(n.code,{children:"LightThreshold"}),"."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["seleziona ",(0,a.jsx)(n.strong,{children:"in ordine"}),": ",(0,a.jsx)(n.code,{children:"ObstacleAvoidance"})," \u2192 ",(0,a.jsx)(n.code,{children:"Phototaxis"})," \u2192 ",(0,a.jsx)(n.code,{children:"RandomWalk"})," (fallback);"]}),"\n",(0,a.jsxs)(n.li,{children:["esegue la policy scelta sul ",(0,a.jsx)(n.code,{children:"BehaviorContext"})," corrente;"]}),"\n",(0,a.jsx)(n.li,{children:"restituisce l\u2019azione (totalit\xe0 garantita) + RNG della policy selezionata (immutato per Obstacle Avoidance/Phototaxis, avanzato per\nRandomWalk)."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"come-estendere-il-sistema-di-behavior",children:"Come estendere il sistema di behavior"}),"\n",(0,a.jsx)(n.p,{children:"Il sistema \xe8 progettato per facilitare l'aggiunta di nuovi comportamenti."}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.em,{children:"nuove condizioni"}),": estendere i predicati per nuovi tipi di sensori."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.em,{children:"nuove azioni"}),": aggiungere azioni al catalogo disponibile."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.em,{children:"nuove policy"}),": comporre comportamenti esistenti o crearne di completamente nuovi."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.em,{children:"nuovi contesti"}),": se necessario, estendere ",(0,a.jsx)(n.code,{children:"BehaviorContext"})," per informazioni aggiuntive (es. memoria)."]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(t,{...e})}):t(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>o});var s=i(6540);const a={},l=s.createContext(a);function r(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);