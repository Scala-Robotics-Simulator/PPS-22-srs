syntax = "proto3";

package io.github.srs.protos;

message InitRequest {
  string config = 1; // YAML string
}

message ResetRequest {
  int32 seed = 1;
}

message ContinuousAction {
  double left_wheel = 1;  // Range: [-1.0, 1.0]
  double right_wheel = 2; // Range: [-1.0, 1.0]
}

message StepRequest { map<string, ContinuousAction> actions = 1; }

message RenderRequest {
  optional int32 width = 1;
  optional int32 height = 2;
}

message CloseRequest {}

message InitResponse {
  bool ok = 1;
  optional string message = 2;
}

message Observation {
  repeated double proximity_values = 1; // Fixed size: 8 values
  repeated double light_values = 2;     // Fixed size: 8 values
  double orientation = 3;               // Degree [0,360)

  message Position {
    double x = 1;
    double y = 2;
  }
  Position position = 4;
  repeated double visited_positions = 5;
}

message ResetResponse {
  map<string, Observation> observations = 1;
  map<string, string> infos = 2;
}

message StepResponse {
  map<string, Observation> observations = 1;
  map<string, double> rewards = 2;
  map<string, bool> terminateds = 3;
  map<string, bool> truncateds = 4;
  map<string, string> infos = 5;
}

message RenderResponse {
  bytes image = 1;
  string format = 2;
  int32 width = 3;
  int32 height = 4;
  int32 channels = 5;
}

message CloseResponse {
  bool ok = 1;
  optional string message = 2;
}

message ErrorResponse {
  string message = 1;
  ErrorCode code = 2;
}

enum ErrorCode {
  UNKNOWN = 0;
  INVALID_CONFIG = 1;
  AGENT_NOT_FOUND = 2;
  INVALID_ACTION = 3;
}

service RL {
  rpc Init(InitRequest) returns (InitResponse) {}
  rpc Reset(ResetRequest) returns (ResetResponse) {}
  rpc Step(StepRequest) returns (StepResponse) {}
  rpc Render(RenderRequest) returns (RenderResponse) {}
  rpc Close(CloseRequest) returns (CloseResponse) {}
}
